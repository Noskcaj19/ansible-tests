---
- name: Ensure Vector config directory exists
  ansible.windows.win_file:
    path: "{{ vector_config_dir }}"
    state: directory

- name: Ensure Vector data directory exists
  ansible.windows.win_file:
    path: "{{ vector_data_dir }}"
    state: directory

- name: Deploy Vector configuration
  ansible.windows.win_template:
    src: vector.yaml.j2
    dest: "{{ vector_config_file }}"
  register: vector_config_deployed
  notify: Restart vector

- name: Validate Vector configuration
  ansible.windows.win_command:
    cmd: '"{{ vector_bin_path }}" validate --config-dir "{{ vector_config_dir }}"'
  changed_when: false
