---
- name: Ensure Vector config directory exists
  ansible.builtin.file:
    path: "{{ vector_config_dir }}"
    state: directory
    owner: root
    group: root
    mode: "0755"

- name: Ensure Vector data directory exists
  ansible.builtin.file:
    path: "{{ vector_data_dir }}"
    state: directory
    owner: "{{ vector_user }}"
    group: "{{ vector_group }}"
    mode: "0750"

- name: Add vector user to docker group
  ansible.builtin.user:
    name: "{{ vector_user }}"
    groups: docker
    append: true
  when: vector_sources_docker_enabled
  notify: Restart vector

- name: Deploy Vector configuration
  ansible.builtin.template:
    src: vector.yaml.j2
    dest: "{{ vector_config_file }}"
    owner: root
    group: "{{ vector_group }}"
    mode: "0640"
    validate: "vector validate --config %s"
  notify: Restart vector
